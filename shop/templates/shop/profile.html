{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-neutral-50 pb-20">
    <div class="bg-black py-12 md:py-20 mb-8 md:mb-12 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl md:text-7xl font-black text-white uppercase tracking-tighter">Command Center</h1>
                    <p class="text-gray-400 mt-2 font-bold uppercase tracking-[0.2em] text-[10px] md:text-xs">
                        Graduate Elite Member • Established {{ request.user.date_joined|date:"Y" }}
                    </p>
                </div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar w-full md:w-auto pb-2 md:pb-0">
                    <div class="bg-white/10 backdrop-blur-md border border-white/20 px-6 py-4 rounded-2xl text-center min-w-[120px]">
                        <p class="text-[10px] font-black text-gray-400 uppercase mb-1">Orders</p>
                        <p class="text-xl font-black text-white">{{ orders|length }}</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md border border-white/20 px-6 py-4 rounded-2xl text-center min-w-[120px]">
                        <p class="text-[10px] font-black text-gray-400 uppercase mb-1">Wishlist</p>
                        <p class="text-xl font-black text-white">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-3">
                <div class="bg-white p-3 rounded-3xl shadow-sm border border-gray-100 sticky top-24 space-y-1">
                    <button onclick="switchTab('details')" id="tab-details" class="profile-tab w-full flex items-center space-x-4 px-6 py-4 rounded-2xl text-xs font-black uppercase tracking-widest transition-all bg-black text-white shadow-xl">
                        <i data-lucide="user" class="w-4 h-4"></i>
                        <span>Profile Details</span>
                    </button>
                    <button onclick="switchTab('orders')" id="tab-orders" class="profile-tab w-full flex items-center space-x-4 px-6 py-4 rounded-2xl text-xs font-black uppercase tracking-widest transition-all text-gray-400 hover:bg-gray-50">
                        <i data-lucide="package" class="w-4 h-4"></i>
                        <span>Order History</span>
                    </button>
                    <button onclick="switchTab('favorites')" id="tab-favorites" class="profile-tab w-full flex items-center space-x-4 px-6 py-4 rounded-2xl text-xs font-black uppercase tracking-widest transition-all text-gray-400 hover:bg-gray-50">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>My Wishlist</span>
                    </button>
                    <button onclick="switchTab('security')" id="tab-security" class="profile-tab w-full flex items-center space-x-4 px-6 py-4 rounded-2xl text-xs font-black uppercase tracking-widest transition-all text-gray-400 hover:bg-gray-50">
                        <i data-lucide="shield" class="w-4 h-4"></i>
                        <span>Security</span>
                    </button>
                    <div class="pt-4 mt-4 border-t border-gray-50">
                        <a href="{% url 'logout' %}" class="flex items-center space-x-4 w-full px-6 py-4 text-red-600 text-xs font-black uppercase tracking-widest hover:bg-red-50 rounded-2xl transition-all">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span>Sign Out</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-9 space-y-8">
                
                <div id="section-details" class="profile-section animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-gray-100">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-10 gap-6">
                            <div class="flex items-center space-x-6">
                                <div class="w-20 h-20 bg-neutral-900 rounded-[1.5rem] flex items-center justify-center text-3xl font-black text-white shadow-2xl rotate-3">
                                    {{ request.user.username|slice:":1"|upper }}
                                </div>
                                <div>
                                    <h2 class="text-2xl font-black uppercase tracking-tighter text-gray-900">{{ request.user.username }}</h2>
                                    <p class="text-sm text-gray-500 font-bold uppercase tracking-widest">Master Account</p>
                                </div>
                            </div>
                            <div class="bg-green-50 px-4 py-2 rounded-full border border-green-100 flex items-center space-x-2">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span class="text-[10px] font-black text-green-700 uppercase">Verified User</span>
                            </div>
                        </div>

                        <form method="POST" class="space-y-8">
                            {% csrf_token %}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div class="space-y-6">
                                    <h3 class="text-[10px] font-black text-gray-300 uppercase tracking-[0.3em] border-b pb-2">Primary Contact</h3>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 ml-1">Phone (+91)</label>
                                        <input type="tel" name="phone" value="{{ profile.phone|default:'' }}"
                                            class="w-full px-6 py-4 bg-gray-50 border-2 border-transparent rounded-2xl focus:bg-white focus:border-black outline-none transition-all font-bold text-sm" placeholder="Contact number">
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 ml-1">Email (Non-Editable)</label>
                                        <input type="email" value="{{ request.user.email }}" disabled
                                            class="w-full px-6 py-4 bg-gray-100 border-2 border-transparent rounded-2xl text-gray-400 font-bold text-sm cursor-not-allowed">
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    <h3 class="text-[10px] font-black text-gray-300 uppercase tracking-[0.3em] border-b pb-2">Shipping Logistics</h3>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 ml-1">Flat / Street / Area</label>
                                        <input type="text" name="address" value="{{ profile.address|default:'' }}"
                                            class="w-full px-6 py-4 bg-gray-50 border-2 border-transparent rounded-2xl focus:bg-white focus:border-black outline-none transition-all font-bold text-sm">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="space-y-1">
                                            <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 ml-1">City</label>
                                            <input type="text" name="city" value="{{ profile.city|default:'' }}" class="w-full px-6 py-4 bg-gray-50 border-2 border-transparent rounded-2xl focus:bg-white focus:border-black outline-none transition-all font-bold text-sm">
                                        </div>
                                        <div class="space-y-1">
                                            <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 ml-1">Pincode</label>
                                            <input type="text" name="zip_code" value="{{ profile.zip_code|default:'' }}" class="w-full px-6 py-4 bg-gray-50 border-2 border-transparent rounded-2xl focus:bg-white focus:border-black outline-none transition-all font-bold text-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="pt-6">
                                <button type="submit"
                                    class="group flex items-center justify-center space-x-3 w-full md:w-auto bg-black text-white px-12 py-5 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-neutral-800 transition-all shadow-2xl active:scale-95">
                                    <span>Sync Profile</span>
                                    <i data-lucide="save" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="section-orders" class="profile-section hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-10">
                            <h2 class="text-2xl font-black uppercase tracking-tighter text-gray-900">Purchase Ledger</h2>
                            <i data-lucide="filter" class="w-5 h-5 text-gray-400 cursor-pointer hover:text-black transition-colors"></i>
                        </div>

                        {% if orders %}
                        <div class="grid grid-cols-1 gap-4">
                            {% for order in orders %}
                            <div class="bg-neutral-50 p-6 rounded-3xl border-2 border-transparent hover:border-black hover:bg-white transition-all group">
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                                    <div class="flex items-center space-x-6">
                                        <div class="text-center bg-white p-3 rounded-2xl shadow-sm border border-gray-100 min-w-[70px]">
                                            <p class="text-[10px] font-black text-gray-400 uppercase">{{ order.created_at|date:"M" }}</p>
                                            <p class="text-xl font-black">{{ order.created_at|date:"d" }}</p>
                                        </div>
                                        <div>
                                            <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Order Ref: #{{ order.id }}</p>
                                            <p class="text-lg font-black text-black mt-1">₹{{ order.total_amount }}</p>
                                            <div class="flex gap-2 mt-2">
                                                {% for item in order.items.all|slice:":3" %}
                                                    <span class="text-[8px] font-bold bg-white px-2 py-1 rounded-md border text-gray-500 uppercase">{{ item.selected_size }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4 w-full md:w-auto">
                                        <div class="flex-1 md:flex-none text-center px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest
                                            {% if order.status == 'Delivered' %}bg-green-100 text-green-700
                                            {% elif order.status == 'Shipped' %}bg-purple-100 text-purple-700
                                            {% else %}bg-yellow-100 text-yellow-700{% endif %}">
                                            {{ order.status }}
                                        </div>
                                        <a href="#" class="flex-1 md:flex-none text-center px-6 py-3 bg-black text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:opacity-80 transition-all">Track</a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                            {% endif %}
                    </div>
                </div>

                <div id="section-favorites" class="profile-section hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="bg-white p-12 rounded-[2.5rem] shadow-sm border border-gray-100 text-center py-24">
                        <div class="w-20 h-20 bg-neutral-50 rounded-full flex items-center justify-center mx-auto mb-8">
                            <i data-lucide="heart" class="w-10 h-10 text-gray-200"></i>
                        </div>
                        <h2 class="text-2xl font-black uppercase tracking-tighter mb-4 text-gray-900">Style Wishlist</h2>
                        <p class="text-gray-400 text-sm font-medium max-w-xs mx-auto mb-10 leading-relaxed">
                            Saving your favorite drops for later? Tap the heart icon on any product to see it here.
                        </p>
                        <a href="{% url 'shop' %}" class="inline-block bg-black text-white px-12 py-5 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-2xl transition-all active:scale-95">Browse The Shop</a>
                    </div>
                </div>

                <div id="section-security" class="profile-section hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="bg-white p-12 rounded-[2.5rem] shadow-sm border border-gray-100">
                        <h2 class="text-2xl font-black uppercase tracking-tighter mb-8 text-gray-900">Vault & Privacy</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-8 rounded-3xl bg-neutral-50 border border-neutral-100 flex flex-col justify-between h-full">
                                <div>
                                    <h4 class="text-sm font-black uppercase mb-2">Change Password</h4>
                                    <p class="text-xs text-gray-500 mb-6 leading-relaxed">Update your login credentials regularly to keep your data secure.</p>
                                </div>
                                <button class="w-full py-4 border-2 border-black rounded-xl text-[10px] font-black uppercase hover:bg-black hover:text-white transition-all">Update Credentials</button>
                            </div>
                            <div class="p-8 rounded-3xl bg-red-50/50 border border-red-100 flex flex-col justify-between h-full">
                                <div>
                                    <h4 class="text-sm font-black uppercase text-red-900 mb-2">Danger Zone</h4>
                                    <p class="text-xs text-red-700/60 mb-6 leading-relaxed">Permanently deactivate your Graduate account and delete all data.</p>
                                </div>
                                <button class="w-full py-4 bg-red-600 text-white rounded-xl text-[10px] font-black uppercase hover:bg-red-700 transition-all shadow-lg shadow-red-200">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
    lucide.createIcons();
    
    function switchTab(tabName) {
        document.querySelectorAll('.profile-section').forEach(section => section.classList.add('hidden'));
        document.querySelectorAll('.profile-tab').forEach(btn => {
            btn.classList.remove('bg-black', 'text-white', 'shadow-xl');
            btn.classList.add('text-gray-400', 'hover:bg-gray-50');
        });

        document.getElementById(`section-${tabName}`).classList.remove('hidden');
        const activeBtn = document.getElementById(`tab-${tabName}`);
        activeBtn.classList.remove('text-gray-400', 'hover:bg-gray-50');
        activeBtn.classList.add('bg-black', 'text-white', 'shadow-xl');
    }
</script>

<style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
{% endblock %}