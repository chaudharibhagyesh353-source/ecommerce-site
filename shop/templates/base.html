{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="vW2yu7owxXOrSpQWcJ_onuMW7h575wnvfPbp6G7O_c8" />
    <title>Graduate kapde wala - E-commerce</title>
    
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="{% static 'js/main.js' %}"></script>

    {% block extra_head %}
    {% endblock %}

    <style>
        /* Basic reset for links */
        a {
            text-decoration: none;
            color: inherit;
        }

        /* Toast Animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        .toast-exit { animation: fadeOut 0.3s ease-in forwards; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Added for Cart Badge */
        .cart-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: black;
            color: white;
            font-size: 8px;
            font-weight: 900;
            padding: 2px 5px;
            border-radius: 99px;
            border: 2px solid white;
        }
    </style>
</head>

<body class="bg-white text-neutral-900 font-sans relative">

    <div id="toast-container" class="fixed top-24 right-5 z-[60] flex flex-col gap-3"></div>

    <header class="sticky top-0 z-50 bg-white border-b border-neutral-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="{% url 'home' %}" 
   class="brand-logo text-xl md:text-2xl tracking-[0.2em] uppercase font-black leading-tight">
    Graduate kapde wala
</a>


                <nav class="hidden md:flex items-center space-x-10">
                    <a href="{% url 'home' %}" class="text-[10px] font-black uppercase tracking-widest {% if request.path == '/' %}text-black{% else %}text-neutral-400 hover:text-black{% endif %}">Home</a>
                    <a href="{% url 'shop' %}" class="text-[10px] font-black uppercase tracking-widest {% if '/shop/' in request.path %}text-black{% else %}text-neutral-400 hover:text-black{% endif %}">Shop All</a>
                    
                    <a href="{% url 'home' %}#best-sellers" class="text-[10px] font-black uppercase tracking-widest text-neutral-400 hover:text-black">Best Sellers</a>
                    
                    <a href="{% url 'about' %}" class="text-[10px] font-black uppercase tracking-widest text-neutral-400 hover:text-black">About</a>
                    <a href="{% url 'contact' %}" class="text-[10px] font-black uppercase tracking-widest text-neutral-400 hover:text-black">Contact</a>
                </nav>

                <div class="flex items-center space-x-5">
                    <div class="hidden md:block relative group">
                        <form action="{% url 'shop' %}" method="GET">
                            <input type="text" name="q" placeholder="Search Style..."
                                class="pl-10 pr-4 py-2 bg-neutral-50 border-transparent rounded-full text-[10px] font-bold uppercase tracking-widest transition-all w-32 focus:w-56 focus:bg-white focus:border-neutral-200 outline-none">
                            <i data-lucide="search" class="w-4 h-4 absolute left-3.5 top-2.5 text-neutral-400"></i>
                        </form>
                    </div>

                    {% if user.is_authenticated %}
                        <a href="{% url 'profile' %}" class="p-2 hover:bg-neutral-50 rounded-full transition-all">
                            <i data-lucide="user" class="w-5 h-5"></i>
                        </a>
                        {% if user.is_staff %}
                        <a href="{% url 'admin_dashboard' %}" class="p-2 hover:bg-neutral-50 rounded-full transition-all">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'login' %}" class="p-2 hover:bg-neutral-50 rounded-full transition-all">
                            <i data-lucide="log-in" class="w-5 h-5"></i>
                        </a>
                    {% endif %}

                    <a href="{% url 'cart' %}" class="p-2 hover:bg-neutral-50 rounded-full transition-all relative">
                        <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                        <span id="cart-count-badge" class="cart-badge hidden">0</span>
                    </a>

                    <button id="mobile-menu-btn" class="md:hidden p-2 hover:bg-neutral-50 rounded-full">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden"></div>
        <div id="mobile-menu" class="fixed top-0 right-0 h-full w-72 bg-white z-50 transform translate-x-full transition-transform duration-500 shadow-2xl flex flex-col p-8">
            <div class="flex justify-between items-center mb-12">
                <span class="font-black uppercase tracking-widest text-xs">Navigation</span>
                <button id="mobile-menu-close" class="p-2 bg-neutral-50 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <nav class="flex flex-col space-y-6">
                <a href="{% url 'home' %}" class="text-xl font-black uppercase tracking-tighter">Home</a>
                <a href="{% url 'shop' %}" class="text-xl font-black uppercase tracking-tighter">Shop All</a>
                <a href="{% url 'about' %}" class="text-xl font-black uppercase tracking-tighter">Our Story</a>
                <a href="{% url 'contact' %}" class="text-xl font-black uppercase tracking-tighter">Support</a>
                <hr class="border-neutral-100">
                {% if user.is_authenticated %}
                    <a href="{% url 'profile' %}" class="text-sm font-bold uppercase tracking-widest">My Account</a>
                    <a href="{% url 'logout' %}" class="text-sm font-bold uppercase tracking-widest text-red-500">Log Out</a>
                {% else %}
                    <a href="{% url 'login' %}" class="py-4 bg-black text-white text-center rounded-xl font-black uppercase text-[10px] tracking-widest">Login / Join</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-neutral-900 text-white pt-20 pb-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                <div>
                    <h3 class="text-xl tracking-[0.2em] uppercase font-black mb-6">Graduate kapde wala</h3>
                    <p class="text-neutral-400 text-xs leading-relaxed uppercase tracking-widest">
                        Crafted essentials for the modern generation. Style that defines the journey.
                    </p>
                </div>
                <div>
                    <h4 class="text-[10px] uppercase tracking-[0.2em] mb-6 font-black text-neutral-500">Quick Links</h4>
                    <ul class="space-y-3 text-[10px] font-bold uppercase tracking-widest">
                        <li><a href="{% url 'shop' %}" class="hover:text-neutral-400 transition-colors">Shop Archive</a></li>
                        <li><a href="{% url 'about' %}" class="hover:text-neutral-400 transition-colors">Our Story</a></li>
                        <li><a href="#" class="hover:text-neutral-400 transition-colors">Size Guide</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-[10px] uppercase tracking-[0.2em] mb-6 font-black text-neutral-500">Logistics</h4>
                    <ul class="space-y-3 text-[10px] font-bold uppercase tracking-widest">
                        <li><a href="#" class="hover:text-neutral-400 transition-colors">Track Shipment</a></li>
                        <li><a href="#" class="hover:text-neutral-400 transition-colors">Returns Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-[10px] uppercase tracking-[0.2em] mb-6 font-black text-neutral-500">Stay Updated</h4>
                    <form id="newsletter-form" action="{% url 'subscribe' %}" method="POST" class="flex border-b border-neutral-700 pb-2">
                        {% csrf_token %}
                        <input type="email" name="email" placeholder="Email Address" required
                            class="flex-1 bg-transparent text-[10px] uppercase font-black outline-none placeholder:text-neutral-700" />
                        <button type="submit" class="hover:translate-x-1 transition-transform">
                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </form>
                </div>
            </div>
            <div class="border-t border-neutral-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex space-x-6">
                    <a href="#" class="text-neutral-500 hover:text-white"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                    <a href="#" class="text-neutral-500 hover:text-white"><i data-lucide="twitter" class="w-4 h-4"></i></a>
                </div>
                <p class="text-[9px] font-bold uppercase tracking-[0.3em] text-neutral-600">
                    © 2026 Graduate kapde wala. Engineered for the world.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Mobile Menu Logic
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuClose = document.getElementById('mobile-menu-close');
        const mobileMenu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');

        function toggleMenu() {
            mobileMenu.classList.toggle('translate-x-full');
            overlay.classList.toggle('hidden');
        }

        if(mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMenu);
        if(mobileMenuClose) mobileMenuClose.addEventListener('click', toggleMenu);
        if(overlay) overlay.addEventListener('click', toggleMenu);

        // ✅ UPDATE: Dynamic Cart Badge Logic
        function updateGlobalCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const badge = document.getElementById('cart-count-badge');
            if (badge && cart.length > 0) {
                const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
                badge.innerText = totalItems;
                badge.classList.remove('hidden');
            } else if (badge) {
                badge.classList.add('hidden');
            }
        }
        
        // Initial call
        updateGlobalCartBadge();

        // Toast System
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast-enter bg-black text-white px-6 py-4 rounded-xl shadow-2xl flex items-center space-x-3 border border-white/10`;
            toast.innerHTML = `
                <div class="w-2 h-2 rounded-full ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}"></div>
                <span class="text-[10px] font-black uppercase tracking-widest">${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.replace('toast-enter', 'toast-exit');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ✅ UPDATE: AJAX for Newsletter Form
        const newsletterForm = document.getElementById('newsletter-form');
        if (newsletterForm) {
            newsletterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showToast(data.message);
                        this.reset();
                    }
                })
                .catch(err => console.error(err));
            });
        }
    </script>
</body>
</html>